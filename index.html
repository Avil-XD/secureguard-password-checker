<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureGuard - Password Security Checker</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <div class="app-wrapper">
            <header>
                <div class="header-top">
                    <div class="title-group">
                        <i class="fas fa-shield-halved"></i>
                        <div class="title-content">
                            <h1>SecureGuard</h1>
                            <p>Advanced Password Security Checker</p>
                        </div>
                    </div>
                    <button id="themeToggle" class="theme-toggle" title="Toggle Dark/Light Theme">
                        <i class="fas fa-moon"></i>
                    </button>
                </div>
                <div class="input-group">
                    <input type="password"
                           id="password"
                           placeholder="Type your password"
                           autocomplete="off"
                           aria-label="Password input"
                           maxlength="128">
                    <button id="togglePassword" class="toggle-btn" type="button" aria-label="Toggle password visibility">
                        <i class="far fa-eye"></i>
                    </button>
                    <button id="generatePassword" class="generate-btn" type="button" aria-label="Generate secure password" title="Generate Password">
                        <i class="fas fa-dice"></i>
                    </button>
                    <button id="clearPassword" class="clear-btn" type="button" aria-label="Clear password" title="Clear Password">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="action-bar">
                    <button id="copyPassword" class="action-btn" type="button" title="Copy Password">
                        <i class="far fa-copy"></i>
                        <span>Copy</span>
                    </button>
                    <button id="exportReport" class="action-btn" type="button" title="Export Analysis Report">
                        <i class="fas fa-download"></i>
                        <span>Export</span>
                    </button>
                    <button id="showHistory" class="action-btn" type="button" title="Password History">
                        <i class="fas fa-history"></i>
                        <span>History</span>
                    </button>
                    <button id="showSettings" class="action-btn" type="button" title="Settings">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                </div>
            </header>

            <div class="info-panel">
                <div class="strength-section">
                    <div id="strength-bar" class="strength-bar">
                        <div id="strength-progress" class="progress"></div>
                    </div>
                    <div class="meter-info">
                        <span id="strength-label">Enter a password to check</span>
                        <span id="score-value"></span>
                    </div>
                </div>

                <div class="status-panels">
                    <div id="analysis" class="panel analysis">
                        <h3 class="panel-title">
                            <i class="fas fa-search"></i>
                            Analysis
                        </h3>
                        <div id="criteria" class="criteria-list"></div>
                        <div id="entropy-info" class="entropy-display"></div>
                    </div>

                    <div id="breach" class="panel breach">
                        <h3 class="panel-title">
                            <i class="fas fa-shield-alt"></i>
                            Security Check
                        </h3>
                        <div id="breach-content"></div>
                    </div>
                </div>

                <div class="advanced-panels">
                    <div id="patterns" class="panel patterns">
                        <h3 class="panel-title">
                            <i class="fas fa-puzzle-piece"></i>
                            Pattern Analysis
                        </h3>
                        <div id="pattern-content"></div>
                    </div>

                    <div id="composition" class="panel composition">
                        <h3 class="panel-title">
                            <i class="fas fa-chart-pie"></i>
                            Composition
                        </h3>
                        <div id="composition-content"></div>
                    </div>
                </div>
            </div>

            <footer>
                <span class="secure-note">
                    <i class="fas fa-lock"></i>
                    Enhanced password analysis with advanced security features
                </span>
                <div class="footer-stats">
                    <span id="check-count">Passwords checked: 0</span>
                    <span id="last-check">Last check: Never</span>
                </div>
            </footer>
        </div>
    </div>

    <!-- Password Generator Modal -->
    <div id="generatorModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-dice"></i> Password & Passphrase Generator</h3>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="generator-tabs">
                    <button id="passwordTab" class="tab-btn active">
                        <i class="fas fa-key"></i> Password
                    </button>
                    <button id="passphraseTab" class="tab-btn">
                        <i class="fas fa-spell-check"></i> Passphrase
                    </button>
                </div>

                <div id="passwordGenerator" class="generator-content active">
                    <div class="generator-options">
                        <div class="option-group">
                            <label for="passLength">Length: <span id="lengthValue">16</span></label>
                            <input type="range" id="passLength" min="8" max="128" value="16">
                        </div>
                        <div class="checkbox-group">
                            <label><input type="checkbox" id="includeUppercase" checked> Uppercase (A-Z)</label>
                            <label><input type="checkbox" id="includeLowercase" checked> Lowercase (a-z)</label>
                            <label><input type="checkbox" id="includeNumbers" checked> Numbers (0-9)</label>
                            <label><input type="checkbox" id="includeSymbols" checked> Symbols (!@#$%^&*)</label>
                            <label><input type="checkbox" id="excludeAmbiguous"> Exclude ambiguous (0,O,l,1)</label>
                        </div>
                    </div>
                </div>

                <div id="passphraseGenerator" class="generator-content">
                    <div class="generator-options">
                        <div class="option-group">
                            <label for="wordCount">Number of Words: <span id="wordCountValue">4</span></label>
                            <input type="range" id="wordCount" min="3" max="8" value="4">
                        </div>
                        <div class="checkbox-group">
                            <label><input type="checkbox" id="capitalizeWords" checked> Capitalize Each Word</label>
                            <label><input type="checkbox" id="includeNumbersPass" checked> Include Numbers</label>
                            <label><input type="checkbox" id="includeSymbolsPass"> Include Symbols Between Words</label>
                        </div>
                        <div class="option-group">
                            <label for="separatorSelect">Word Separator:</label>
                            <select id="separatorSelect">
                                <option value="-">Hyphen (-)</option>
                                <option value="_">Underscore (_)</option>
                                <option value=".">Period (.)</option>
                                <option value=" ">Space ( )</option>
                                <option value="">None</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <div class="generator-result">
                    <input type="text" id="generatedPassword" readonly placeholder="Generated password will appear here">
                    <button id="copyGenerated" class="copy-btn" title="Copy Generated Password">
                        <i class="far fa-copy"></i>
                    </button>
                </div>
                
                <div class="generator-actions">
                    <button id="regeneratePassword" class="btn primary">
                        <i class="fas fa-redo"></i> Generate
                    </button>
                    <button id="useGenerated" class="btn success">
                        <i class="fas fa-check"></i> Use Password
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- History Modal -->
    <div id="historyModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-history"></i> Password History</h3>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="history-controls">
                    <button id="clearHistory" class="btn danger">
                        <i class="fas fa-trash"></i> Clear History
                    </button>
                </div>
                <div id="historyList" class="history-list">
                    <div class="empty-state">
                        <i class="fas fa-history"></i>
                        <p>No password history available</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-cog"></i> Settings</h3>
                <button class="modal-close" aria-label="Close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-group">
                    <h4>Security Options</h4>
                    <label><input type="checkbox" id="enableBreachCheck" checked> Check for data breaches</label>
                    <label><input type="checkbox" id="enableHistory" checked> Save password history</label>
                    <label><input type="checkbox" id="enableNotifications" checked> Show notifications</label>
                </div>
                <div class="settings-group">
                    <h4>Analysis Options</h4>
                    <label><input type="checkbox" id="enablePatternAnalysis" checked> Pattern analysis</label>
                    <label><input type="checkbox" id="enableComposition" checked> Character composition</label>
                    <label><input type="checkbox" id="enableEntropy" checked> Entropy calculation</label>
                </div>
                <div class="settings-group">
                    <h4>Performance</h4>
                    <label for="debounceDelay">Analysis delay (ms): <span id="debounceValue">300</span></label>
                    <input type="range" id="debounceDelay" min="100" max="1000" value="300" step="50">
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div id="notifications" class="notification-container"></div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/zxcvbn/4.4.2/zxcvbn.js"></script>
    <script>
        // Enhanced SecureGuard Password Checker
        class SecureGuard {
            constructor() {
                this.initializeElements();
                this.initializeState();
                this.bindEvents();
                this.loadSettings();
                this.initializeKeyboardShortcuts();
            }

            initializeElements() {
                this.els = {
                    // Core elements
                    password: document.getElementById('password'),
                    toggleBtn: document.getElementById('togglePassword'),
                    generateBtn: document.getElementById('generatePassword'),
                    clearBtn: document.getElementById('clearPassword'),
                    themeToggle: document.getElementById('themeToggle'),
                    
                    // Action buttons
                    copyBtn: document.getElementById('copyPassword'),
                    exportBtn: document.getElementById('exportReport'),
                    historyBtn: document.getElementById('showHistory'),
                    settingsBtn: document.getElementById('showSettings'),
                    
                    // Display elements
                    strengthBar: document.getElementById('strength-bar'),
                    strengthProgress: document.getElementById('strength-progress'),
                    strengthLabel: document.getElementById('strength-label'),
                    scoreValue: document.getElementById('score-value'),
                    
                    // Panels
                    analysis: document.getElementById('analysis'),
                    criteria: document.getElementById('criteria'),
                    breach: document.getElementById('breach'),
                    breachContent: document.getElementById('breach-content'),
                    patterns: document.getElementById('patterns'),
                    patternContent: document.getElementById('pattern-content'),
                    composition: document.getElementById('composition'),
                    compositionContent: document.getElementById('composition-content'),
                    entropyInfo: document.getElementById('entropy-info'),
                    
                    // Footer stats
                    checkCount: document.getElementById('check-count'),
                    lastCheck: document.getElementById('last-check'),
                    
                    // Modals
                    generatorModal: document.getElementById('generatorModal'),
                    historyModal: document.getElementById('historyModal'),
                    settingsModal: document.getElementById('settingsModal'),
                    notifications: document.getElementById('notifications')
                };
            }

            initializeState() {
                this.strengthLabels = ['Very Weak', 'Weak', 'Fair', 'Strong', 'Very Strong'];
                this.strengthColors = ['#ff5252', '#ffa502', '#ffa502', '#00b894', '#6c5ce7'];
                this.lastCheckedPassword = '';
                this.currentAnalysis = null;
                this.debounceTimer = null;
                this.currentGeneratorMode = 'password';
                this.settings = {
                    enableBreachCheck: true,
                    enableHistory: true,
                    enableNotifications: true,
                    enablePatternAnalysis: true,
                    enableComposition: true,
                    enableEntropy: true,
                    debounceDelay: 300,
                    theme: localStorage.getItem('secureguard-theme') || 'dark'
                };
                this.passwordHistory = this.loadHistory();
                this.checkCount = parseInt(localStorage.getItem('sg-check-count') || '0');
                this.wordList = [
                    'apple', 'brave', 'cloud', 'dance', 'eagle', 'flame', 'grace', 'happy', 'island', 'jungle',
                    'knight', 'light', 'magic', 'noble', 'ocean', 'peace', 'quiet', 'royal', 'storm', 'trust',
                    'unity', 'valor', 'wonder', 'youth', 'zebra', 'anchor', 'bridge', 'castle', 'dragon', 'energy',
                    'forest', 'galaxy', 'harmony', 'insight', 'justice', 'karma', 'legend', 'mystic', 'nature', 'orbit',
                    'portal', 'quartz', 'rainbow', 'silver', 'thunder', 'universe', 'victory', 'wisdom', 'xenon', 'yellow'
                ];
                this.updateCheckCount();
                this.applyTheme(this.settings.theme);
            }

            bindEvents() {
                // Core functionality
                this.els.password.addEventListener('input', (e) => this.handlePasswordInput(e.target.value));
                this.els.toggleBtn.addEventListener('click', () => this.togglePasswordVisibility());
                this.els.generateBtn.addEventListener('click', () => this.showGeneratorModal());
                this.els.clearBtn.addEventListener('click', () => this.clearPassword());
                this.els.themeToggle.addEventListener('click', () => this.toggleTheme());
                
                // Action buttons
                this.els.copyBtn.addEventListener('click', () => this.copyPassword());
                this.els.exportBtn.addEventListener('click', () => this.exportReport());
                this.els.historyBtn.addEventListener('click', () => this.showHistoryModal());
                this.els.settingsBtn.addEventListener('click', () => this.showSettingsModal());
                
                // Modal events
                this.bindModalEvents();
                this.bindGeneratorEvents();
                this.bindHistoryEvents();
                this.bindSettingsEvents();
            }

            bindModalEvents() {
                // Close modals
                document.querySelectorAll('.modal-close').forEach(btn => {
                    btn.addEventListener('click', () => this.closeAllModals());
                });
                
                // Close on backdrop click
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.addEventListener('click', (e) => {
                        if (e.target === modal) this.closeAllModals();
                    });
                });
            }

            bindGeneratorEvents() {
                // Tab switching
                const passwordTab = document.getElementById('passwordTab');
                const passphraseTab = document.getElementById('passphraseTab');
                
                if (passwordTab) {
                    passwordTab.addEventListener('click', () => this.switchGeneratorTab('password'));
                }
                
                if (passphraseTab) {
                    passphraseTab.addEventListener('click', () => this.switchGeneratorTab('passphrase'));
                }

                // Password generator controls
                const lengthSlider = document.getElementById('passLength');
                const lengthValue = document.getElementById('lengthValue');
                
                // Passphrase generator controls
                const wordCountSlider = document.getElementById('wordCount');
                const wordCountValue = document.getElementById('wordCountValue');

                // Common controls
                const generateBtn = document.getElementById('regeneratePassword');
                const useBtn = document.getElementById('useGenerated');
                const copyBtn = document.getElementById('copyGenerated');
                
                if (lengthSlider) {
                    lengthSlider.addEventListener('input', (e) => {
                        lengthValue.textContent = e.target.value;
                        this.generatePassword();
                    });
                }
                
                if (wordCountSlider) {
                    wordCountSlider.addEventListener('input', (e) => {
                        wordCountValue.textContent = e.target.value;
                        this.generatePassword();
                    });
                }
                
                document.querySelectorAll('#generatorModal input[type="checkbox"], #generatorModal select').forEach(control => {
                    control.addEventListener('change', () => this.generatePassword());
                });
                
                if (generateBtn) {
                    generateBtn.addEventListener('click', () => this.generatePassword());
                }
                
                if (useBtn) {
                    useBtn.addEventListener('click', () => this.useGeneratedPassword());
                }
                
                if (copyBtn) {
                    copyBtn.addEventListener('click', () => this.copyGeneratedPassword());
                }
            }

            bindHistoryEvents() {
                document.getElementById('clearHistory').addEventListener('click', () => this.clearHistory());
            }

            bindSettingsEvents() {
                // Settings checkboxes
                Object.keys(this.settings).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        element.addEventListener('change', (e) => {
                            this.settings[key] = e.target.checked;
                            this.saveSettings();
                        });
                    }
                });
                
                // Debounce delay slider
                const debounceSlider = document.getElementById('debounceDelay');
                const debounceValue = document.getElementById('debounceValue');
                debounceSlider.addEventListener('input', (e) => {
                    this.settings.debounceDelay = parseInt(e.target.value);
                    debounceValue.textContent = e.target.value;
                    this.saveSettings();
                });
            }

            initializeKeyboardShortcuts() {
                document.addEventListener('keydown', (e) => {
                    if (e.ctrlKey || e.metaKey) {
                        switch(e.key) {
                            case 'g':
                                e.preventDefault();
                                this.showGeneratorModal();
                                break;
                            case 'h':
                                e.preventDefault();
                                this.showHistoryModal();
                                break;
                            case 'c':
                                if (this.els.password.value) {
                                    e.preventDefault();
                                    this.copyPassword();
                                }
                                break;
                        }
                    }
                    if (e.key === 'Escape') {
                        this.closeAllModals();
                    }
                });
            }

            handlePasswordInput(password) {
                clearTimeout(this.debounceTimer);
                this.debounceTimer = setTimeout(() => {
                    this.updatePassword(password);
                }, this.settings.debounceDelay);
            }

            async updatePassword(password) {
                if (!password) {
                    this.resetAnalysis();
                    return;
                }

                this.incrementCheckCount();
                this.addToHistory(password);
                
                const result = zxcvbn(password);
                this.currentAnalysis = {
                    password,
                    score: result.score,
                    feedback: result.feedback,
                    crackTime: result.crack_times_display,
                    entropy: this.calculateEntropy(password),
                    composition: this.analyzeComposition(password),
                    patterns: this.analyzePatterns(password),
                    timestamp: new Date().toISOString()
                };

                this.updateStrengthDisplay(result);
                this.updateAnalysisDisplay();
                
                if (this.settings.enableComposition) this.updateCompositionDisplay();
                if (this.settings.enablePatternAnalysis) this.updatePatternsDisplay();
                if (this.settings.enableEntropy) this.updateEntropyDisplay();
                if (this.settings.enableBreachCheck && password.length >= 3) this.checkBreach(password);
            }

            updateStrengthDisplay(result) {
                const score = result.score;
                this.els.strengthProgress.style.width = `${(score + 1) * 20}%`;
                this.els.strengthProgress.style.backgroundColor = this.strengthColors[score];
                this.els.strengthLabel.textContent = this.strengthLabels[score];
                this.els.scoreValue.textContent = `${score}/4`;
            }

            updateAnalysisDisplay() {
                const result = this.currentAnalysis;
                this.els.analysis.classList.add('active');
                
                let html = '';
                if (result.feedback.warning) {
                    html += `<div class="warning"><i class="fas fa-exclamation-triangle"></i>${result.feedback.warning}</div>`;
                }
                
                result.feedback.suggestions.forEach(suggestion => {
                    html += `<div class="suggestion"><i class="fas fa-lightbulb"></i>${suggestion}</div>`;
                });
                
                // Add crack time information
                html += `<div class="crack-time">
                    <i class="fas fa-clock"></i>
                    <strong>Time to crack:</strong> ${result.crackTime.offline_slow_hashing_1e4_per_second}
                </div>`;
                
                this.els.criteria.innerHTML = html;
            }

            updateCompositionDisplay() {
                const comp = this.currentAnalysis.composition;
                this.els.composition.classList.add('active');
                
                const total = this.currentAnalysis.password.length;
                this.els.compositionContent.innerHTML = `
                    <div class="composition-chart">
                        <div class="comp-item">
                            <span class="comp-label">Uppercase</span>
                            <div class="comp-bar">
                                <div class="comp-fill" style="width: ${(comp.uppercase/total)*100}%"></div>
                            </div>
                            <span class="comp-count">${comp.uppercase}</span>
                        </div>
                        <div class="comp-item">
                            <span class="comp-label">Lowercase</span>
                            <div class="comp-bar">
                                <div class="comp-fill" style="width: ${(comp.lowercase/total)*100}%"></div>
                            </div>
                            <span class="comp-count">${comp.lowercase}</span>
                        </div>
                        <div class="comp-item">
                            <span class="comp-label">Numbers</span>
                            <div class="comp-bar">
                                <div class="comp-fill" style="width: ${(comp.numbers/total)*100}%"></div>
                            </div>
                            <span class="comp-count">${comp.numbers}</span>
                        </div>
                        <div class="comp-item">
                            <span class="comp-label">Symbols</span>
                            <div class="comp-bar">
                                <div class="comp-fill" style="width: ${(comp.symbols/total)*100}%"></div>
                            </div>
                            <span class="comp-count">${comp.symbols}</span>
                        </div>
                    </div>
                `;
            }

            updatePatternsDisplay() {
                const patterns = this.currentAnalysis.patterns;
                this.els.patterns.classList.add('active');
                
                let html = '<div class="pattern-list">';
                patterns.forEach(pattern => {
                    const iconClass = pattern.severity === 'high' ? 'fa-exclamation-circle' :
                                     pattern.severity === 'medium' ? 'fa-exclamation-triangle' : 'fa-info-circle';
                    html += `
                        <div class="pattern-item ${pattern.severity}">
                            <i class="fas ${iconClass}"></i>
                            <span>${pattern.description}</span>
                        </div>
                    `;
                });
                html += '</div>';
                
                this.els.patternContent.innerHTML = html;
            }

            updateEntropyDisplay() {
                const entropy = this.currentAnalysis.entropy;
                this.els.entropyInfo.innerHTML = `
                    <div class="entropy-item">
                        <span class="entropy-label">Entropy:</span>
                        <span class="entropy-value">${entropy.toFixed(2)} bits</span>
                    </div>
                    <div class="entropy-description">
                        ${this.getEntropyDescription(entropy)}
                    </div>
                `;
            }

            async checkBreach(password) {
                if (password === this.lastCheckedPassword) return;
                this.lastCheckedPassword = password;
                
                // Show loading state
                this.els.breach.classList.add('active');
                this.els.breach.className = 'panel breach loading active';
                this.els.breachContent.innerHTML = `
                    <div class="breach-loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <div class="breach-details">
                            <strong>Checking breach databases...</strong>
                            <span>Securely analyzing password against known data breaches</span>
                        </div>
                    </div>
                `;
                
                try {
                    const encoder = new TextEncoder();
                    const data = await crypto.subtle.digest('SHA-1', encoder.encode(password));
                    const hashArray = Array.from(new Uint8Array(data));
                    const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('').toUpperCase();
                    const prefix = hashHex.substring(0, 5);
                    const suffix = hashHex.substring(5);

                    const response = await fetch(`https://api.pwnedpasswords.com/range/${prefix}`);
                    const results = await response.text();
                    const match = results.split('\n').find(line => line.split(':')[0] === suffix);
                    
                    if (match) {
                        const [, count] = match.split(':');
                        const breachCount = parseInt(count.trim());
                        const riskLevel = this.assessBreachRisk(breachCount);
                        
                        this.els.breach.className = 'panel breach danger active';
                        this.els.breachContent.innerHTML = `
                            <div class="breach-header">
                                <i class="fas fa-exclamation-triangle"></i>
                                <div class="breach-title">
                                    <strong>Password Compromised</strong>
                                    <span class="risk-badge ${riskLevel.class}">${riskLevel.level}</span>
                                </div>
                            </div>
                            
                            <div class="breach-stats">
                                <div class="breach-stat">
                                    <i class="fas fa-database"></i>
                                    <div>
                                        <strong>${breachCount.toLocaleString()}</strong>
                                        <span>Times found in breaches</span>
                                    </div>
                                </div>
                                <div class="breach-stat">
                                    <i class="fas fa-users"></i>
                                    <div>
                                        <strong>${this.getPopularityRating(breachCount)}</strong>
                                        <span>Password popularity</span>
                                    </div>
                                </div>
                            </div>

                            <div class="breach-explanation">
                                <h4><i class="fas fa-info-circle"></i> What this means:</h4>
                                <p>${this.getBreachExplanation(breachCount)}</p>
                            </div>

                            <div class="breach-risks">
                                <h4><i class="fas fa-shield-virus"></i> Security Risks:</h4>
                                <ul>
                                    <li>Attackers have this password in their dictionaries</li>
                                    <li>Automated attacks may try this password first</li>
                                    <li>If used elsewhere, other accounts may be at risk</li>
                                    ${breachCount > 1000 ? '<li>This is among the most commonly used passwords</li>' : ''}
                                </ul>
                            </div>

                            <div class="breach-recommendations">
                                <h4><i class="fas fa-lightbulb"></i> Recommended Actions:</h4>
                                <div class="recommendations-grid">
                                    <div class="recommendation urgent">
                                        <i class="fas fa-exclamation"></i>
                                        <div>
                                            <strong>Immediate</strong>
                                            <span>Change this password now</span>
                                        </div>
                                    </div>
                                    <div class="recommendation important">
                                        <i class="fas fa-key"></i>
                                        <div>
                                            <strong>Use unique passwords</strong>
                                            <span>Don't reuse across accounts</span>
                                        </div>
                                    </div>
                                    <div class="recommendation helpful">
                                        <i class="fas fa-shield-check"></i>
                                        <div>
                                            <strong>Enable 2FA</strong>
                                            <span>Add extra security layer</span>
                                        </div>
                                    </div>
                                    <div class="recommendation helpful">
                                        <i class="fas fa-tools"></i>
                                        <div>
                                            <strong>Use password manager</strong>
                                            <span>Generate & store securely</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="breach-actions">
                                <button class="btn danger" onclick="secureGuard.showGeneratorModal()">
                                    <i class="fas fa-dice"></i> Generate Secure Password
                                </button>
                                <button class="btn secondary" onclick="secureGuard.showBreachInfo()">
                                    <i class="fas fa-info"></i> Learn More
                                </button>
                            </div>
                        `;
                        
                        if (this.settings.enableNotifications) {
                            this.showNotification('Password Compromised!', `Found in ${breachCount.toLocaleString()} data breaches`, 'danger');
                        }
                    } else {
                        this.els.breach.className = 'panel breach success active';
                        this.els.breachContent.innerHTML = `
                            <div class="breach-header success">
                                <i class="fas fa-shield-check"></i>
                                <div class="breach-title">
                                    <strong>No Breaches Found</strong>
                                    <span class="risk-badge safe">Secure</span>
                                </div>
                            </div>
                            
                            <div class="breach-explanation">
                                <h4><i class="fas fa-info-circle"></i> What this means:</h4>
                                <p>This password hasn't been found in any known data breaches. However, this doesn't guarantee it's strong - it could still be weak or predictable.</p>
                            </div>

                            <div class="breach-good-practices">
                                <h4><i class="fas fa-check-circle"></i> Security Best Practices:</h4>
                                <ul>
                                    <li>Use unique passwords for each account</li>
                                    <li>Combine with strong password strength (aim for "Strong" or higher)</li>
                                    <li>Enable two-factor authentication when available</li>
                                    <li>Consider using a password manager</li>
                                    <li>Regularly update passwords for important accounts</li>
                                </ul>
                            </div>

                            <div class="hibp-info">
                                <h4><i class="fas fa-database"></i> About This Check:</h4>
                                <p>We check against <strong>Have I Been Pwned</strong>, a database of ${this.getHIBPStats()} compromised passwords from real data breaches. Your password is hashed before checking, ensuring privacy.</p>
                            </div>

                            <div class="breach-actions">
                                <button class="btn success" onclick="secureGuard.showGeneratorModal()">
                                    <i class="fas fa-plus"></i> Generate Another
                                </button>
                                <button class="btn secondary" onclick="secureGuard.showBreachInfo()">
                                    <i class="fas fa-info"></i> Learn More
                                </button>
                            </div>
                        `;
                    }
                } catch (error) {
                    console.warn('Breach check failed, retrying...', error);
                    this.els.breach.className = 'panel breach warning active';
                    this.els.breachContent.innerHTML = `
                        <div class="breach-header warning">
                            <i class="fas fa-exclamation-triangle"></i>
                            <div class="breach-title">
                                <strong>Breach Check Unavailable</strong>
                                <span class="risk-badge warning">Unknown</span>
                            </div>
                        </div>
                        
                        <div class="breach-explanation">
                            <h4><i class="fas fa-wifi"></i> Connection Issue:</h4>
                            <p>Unable to check against breach databases. This could be due to network connectivity or the Have I Been Pwned service being temporarily unavailable.</p>
                        </div>

                        <div class="breach-fallback">
                            <h4><i class="fas fa-shield-alt"></i> Manual Security Check:</h4>
                            <ul>
                                <li>Avoid common passwords (password123, qwerty, etc.)</li>
                                <li>Don't use personal information (names, birthdays)</li>
                                <li>Check the strength meter above for guidance</li>
                                <li>Consider using our password generator</li>
                            </ul>
                        </div>

                        <div class="breach-actions">
                            <button class="btn primary" onclick="secureGuard.checkBreach(secureGuard.els.password.value)">
                                <i class="fas fa-redo"></i> Retry Check
                            </button>
                            <button class="btn secondary" onclick="secureGuard.showGeneratorModal()">
                                <i class="fas fa-dice"></i> Generate Password
                            </button>
                        </div>
                    `;
                    
                    setTimeout(() => this.checkBreach(password), 3000);
                }
            }

            assessBreachRisk(count) {
                if (count > 100000) return { level: 'CRITICAL', class: 'critical' };
                if (count > 10000) return { level: 'HIGH', class: 'high' };
                if (count > 1000) return { level: 'MODERATE', class: 'moderate' };
                return { level: 'LOW', class: 'low' };
            }

            getPopularityRating(count) {
                if (count > 1000000) return 'Extremely Common';
                if (count > 100000) return 'Very Common';
                if (count > 10000) return 'Common';
                if (count > 1000) return 'Moderately Used';
                return 'Rarely Seen';
            }

            getBreachExplanation(count) {
                if (count > 1000000) {
                    return 'This password is among the most commonly used passwords in the world. It appears in virtually every password attack list and should never be used.';
                } else if (count > 100000) {
                    return 'This password is very commonly used and appears frequently in data breaches. Attackers actively target accounts using this password.';
                } else if (count > 10000) {
                    return 'This password appears regularly in data breaches and is known to attackers. It poses a significant security risk.';
                } else if (count > 1000) {
                    return 'This password has been found in multiple data breaches and may be targeted by automated attacks.';
                } else {
                    return 'While this password has been found in data breaches, it\'s less commonly targeted. However, it\'s still recommended to change it.';
                }
            }

            getHIBPStats() {
                return 'over 847 million'; // Update this periodically with current HIBP stats
            }

            showBreachInfo() {
                // Create and show educational modal about data breaches
                const modal = document.createElement('div');
                modal.className = 'modal';
                modal.style.display = 'flex';
                modal.innerHTML = `
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3><i class="fas fa-graduation-cap"></i> Understanding Data Breaches</h3>
                            <button class="modal-close" onclick="this.closest('.modal').remove()">&times;</button>
                        </div>
                        <div class="modal-body">
                            <div class="education-content">
                                <section>
                                    <h4><i class="fas fa-question-circle"></i> What is a Data Breach?</h4>
                                    <p>A data breach occurs when unauthorized individuals gain access to confidential data, including usernames and passwords. These passwords are then often sold or shared, making them known to attackers worldwide.</p>
                                </section>
                                
                                <section>
                                    <h4><i class="fas fa-database"></i> Have I Been Pwned Database</h4>
                                    <p>Created by security researcher Troy Hunt, HIBP aggregates data from hundreds of verified breaches, allowing you to check if your passwords have been compromised. The service has helped millions of people improve their security.</p>
                                </section>
                                
                                <section>
                                    <h4><i class="fas fa-shield-alt"></i> Privacy Protection</h4>
                                    <p>Your password never leaves your device. We use a technique called "k-anonymity" where only the first 5 characters of your password's hash are sent to check against the database, ensuring your privacy.</p>
                                </section>
                                
                                <section>
                                    <h4><i class="fas fa-lightbulb"></i> Best Practices</h4>
                                    <ul>
                                        <li>Use unique passwords for every account</li>
                                        <li>Enable two-factor authentication</li>
                                        <li>Use a reputable password manager</li>
                                        <li>Regularly update passwords for important accounts</li>
                                        <li>Monitor your accounts for suspicious activity</li>
                                    </ul>
                                </section>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
                
                // Close on backdrop click
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) modal.remove();
                });
            }

            // Utility functions
            calculateEntropy(password) {
                const charset = new Set(password).size;
                return password.length * Math.log2(charset);
            }

            analyzeComposition(password) {
                return {
                    uppercase: (password.match(/[A-Z]/g) || []).length,
                    lowercase: (password.match(/[a-z]/g) || []).length,
                    numbers: (password.match(/[0-9]/g) || []).length,
                    symbols: (password.match(/[^A-Za-z0-9]/g) || []).length
                };
            }

            analyzePatterns(password) {
                const patterns = [];
                
                // Common patterns
                if (/(.)\1{2,}/.test(password)) {
                    patterns.push({description: 'Contains repeated characters', severity: 'medium'});
                }
                if (/123|abc|qwe/i.test(password)) {
                    patterns.push({description: 'Contains sequential characters', severity: 'high'});
                }
                if (/password|123456|qwerty/i.test(password)) {
                    patterns.push({description: 'Contains common password patterns', severity: 'high'});
                }
                if (password.length < 8) {
                    patterns.push({description: 'Password is too short', severity: 'high'});
                }
                if (!/[A-Z]/.test(password)) {
                    patterns.push({description: 'Missing uppercase letters', severity: 'medium'});
                }
                if (!/[a-z]/.test(password)) {
                    patterns.push({description: 'Missing lowercase letters', severity: 'medium'});
                }
                if (!/[0-9]/.test(password)) {
                    patterns.push({description: 'Missing numbers', severity: 'low'});
                }
                if (!/[^A-Za-z0-9]/.test(password)) {
                    patterns.push({description: 'Missing special characters', severity: 'low'});
                }
                
                return patterns;
            }

            getEntropyDescription(entropy) {
                if (entropy < 30) return 'Very weak entropy';
                if (entropy < 50) return 'Weak entropy';
                if (entropy < 70) return 'Moderate entropy';
                if (entropy < 90) return 'Strong entropy';
                return 'Very strong entropy';
            }

            // Password generation
            generatePassword() {
                if (this.currentGeneratorMode === 'passphrase') {
                    this.generatePassphrase();
                } else {
                    this.generateRandomPassword();
                }
            }

            generateRandomPassword() {
                const length = parseInt(document.getElementById('passLength').value);
                const includeUpper = document.getElementById('includeUppercase').checked;
                const includeLower = document.getElementById('includeLowercase').checked;
                const includeNumbers = document.getElementById('includeNumbers').checked;
                const includeSymbols = document.getElementById('includeSymbols').checked;
                const excludeAmbiguous = document.getElementById('excludeAmbiguous').checked;
                
                let charset = '';
                if (includeUpper) charset += excludeAmbiguous ? 'ABCDEFGHJKLMNPQRSTUVWXYZ' : 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                if (includeLower) charset += excludeAmbiguous ? 'abcdefghijkmnopqrstuvwxyz' : 'abcdefghijklmnopqrstuvwxyz';
                if (includeNumbers) charset += excludeAmbiguous ? '23456789' : '0123456789';
                if (includeSymbols) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';
                
                if (!charset) {
                    this.showNotification('Error', 'Please select at least one character type', 'danger');
                    return;
                }
                
                let password = '';
                const array = new Uint8Array(length);
                crypto.getRandomValues(array);
                
                for (let i = 0; i < length; i++) {
                    password += charset[array[i] % charset.length];
                }
                
                document.getElementById('generatedPassword').value = password;
            }

            generatePassphrase() {
                const wordCount = parseInt(document.getElementById('wordCount').value);
                const capitalizeWords = document.getElementById('capitalizeWords').checked;
                const includeNumbers = document.getElementById('includeNumbersPass').checked;
                const includeSymbols = document.getElementById('includeSymbolsPass').checked;
                const separator = document.getElementById('separatorSelect').value;
                
                // Select random words
                const selectedWords = [];
                const usedIndices = new Set();
                
                while (selectedWords.length < wordCount) {
                    const randomIndex = Math.floor(Math.random() * this.wordList.length);
                    if (!usedIndices.has(randomIndex)) {
                        usedIndices.add(randomIndex);
                        let word = this.wordList[randomIndex];
                        
                        if (capitalizeWords) {
                            word = word.charAt(0).toUpperCase() + word.slice(1);
                        }
                        
                        selectedWords.push(word);
                    }
                }
                
                let passphrase = selectedWords.join(separator);
                
                // Add numbers if requested
                if (includeNumbers) {
                    const numberCount = Math.floor(Math.random() * 3) + 1; // 1-3 numbers
                    for (let i = 0; i < numberCount; i++) {
                        const randomNumber = Math.floor(Math.random() * 100);
                        const position = Math.floor(Math.random() * (passphrase.length + 1));
                        passphrase = passphrase.slice(0, position) + randomNumber + passphrase.slice(position);
                    }
                }
                
                // Add symbols if requested
                if (includeSymbols) {
                    const symbols = ['!', '@', '#', '$', '%', '^', '&', '*'];
                    const symbolCount = Math.floor(Math.random() * 2) + 1; // 1-2 symbols
                    for (let i = 0; i < symbolCount; i++) {
                        const randomSymbol = symbols[Math.floor(Math.random() * symbols.length)];
                        const position = Math.floor(Math.random() * (passphrase.length + 1));
                        passphrase = passphrase.slice(0, position) + randomSymbol + passphrase.slice(position);
                    }
                }
                
                document.getElementById('generatedPassword').value = passphrase;
            }

            switchGeneratorTab(mode) {
                this.currentGeneratorMode = mode;
                
                // Update tab appearance
                document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(mode + 'Tab').classList.add('active');
                
                // Show/hide generator content
                document.querySelectorAll('.generator-content').forEach(content => content.classList.remove('active'));
                document.getElementById(mode + 'Generator').classList.add('active');
                
                // Generate new password/passphrase
                this.generatePassword();
            }

            toggleTheme() {
                const newTheme = this.settings.theme === 'dark' ? 'light' : 'dark';
                this.settings.theme = newTheme;
                this.applyTheme(newTheme);
                this.saveSettings();
                
                if (this.settings.enableNotifications) {
                    this.showNotification('Theme Changed', `Switched to ${newTheme} theme`, 'success');
                }
            }

            applyTheme(theme) {
                document.body.classList.toggle('light-theme', theme === 'light');
                
                // Update theme toggle icon
                const themeIcon = this.els.themeToggle.querySelector('i');
                if (themeIcon) {
                    themeIcon.className = theme === 'dark' ? 'fas fa-sun' : 'fas fa-moon';
                }
                
                // Save theme preference
                localStorage.setItem('secureguard-theme', theme);
            }

            useGeneratedPassword() {
                const generated = document.getElementById('generatedPassword').value;
                if (generated) {
                    this.els.password.value = generated;
                    this.updatePassword(generated);
                    this.closeAllModals();
                    this.showNotification('Success', 'Generated password applied', 'success');
                }
            }

            async copyGeneratedPassword() {
                const generated = document.getElementById('generatedPassword').value;
                if (generated) {
                    await this.copyToClipboard(generated);
                    this.showNotification('Copied', 'Generated password copied to clipboard', 'success');
                }
            }

            // Actions
            togglePasswordVisibility() {
                const type = this.els.password.type === 'password' ? 'text' : 'password';
                this.els.password.type = type;
                this.els.toggleBtn.querySelector('i').className =
                    `far fa-${type === 'password' ? 'eye' : 'eye-slash'}`;
            }

            clearPassword() {
                this.els.password.value = '';
                this.resetAnalysis();
                this.showNotification('Cleared', 'Password field cleared', 'info');
            }

            async copyPassword() {
                const password = this.els.password.value;
                if (password) {
                    await this.copyToClipboard(password);
                    this.showNotification('Copied', 'Password copied to clipboard', 'success');
                }
            }

            async copyToClipboard(text) {
                try {
                    await navigator.clipboard.writeText(text);
                } catch (err) {
                    // Fallback for older browsers
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                }
            }

            exportReport() {
                if (!this.currentAnalysis) {
                    this.showNotification('Error', 'No analysis data to export', 'danger');
                    return;
                }
                
                const report = {
                    timestamp: new Date().toISOString(),
                    passwordLength: this.currentAnalysis.password.length,
                    strength: this.strengthLabels[this.currentAnalysis.score],
                    score: this.currentAnalysis.score,
                    entropy: this.currentAnalysis.entropy,
                    composition: this.currentAnalysis.composition,
                    patterns: this.currentAnalysis.patterns,
                    crackTime: this.currentAnalysis.crackTime,
                    feedback: this.currentAnalysis.feedback
                };
                
                const blob = new Blob([JSON.stringify(report, null, 2)], {type: 'application/json'});
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `password-analysis-${Date.now()}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
                this.showNotification('Exported', 'Analysis report downloaded', 'success');
            }

            // History management
            addToHistory(password) {
                if (!this.settings.enableHistory || !password) return;
                
                const entry = {
                    length: password.length,
                    strength: this.strengthLabels[this.currentAnalysis?.score || 0],
                    timestamp: new Date().toISOString(),
                    patterns: this.currentAnalysis?.patterns?.length || 0
                };
                
                this.passwordHistory.unshift(entry);
                this.passwordHistory = this.passwordHistory.slice(0, 50); // Keep last 50
                this.saveHistory();
            }

            loadHistory() {
                try {
                    return JSON.parse(localStorage.getItem('sg-password-history') || '[]');
                } catch {
                    return [];
                }
            }

            saveHistory() {
                localStorage.setItem('sg-password-history', JSON.stringify(this.passwordHistory));
            }

            clearHistory() {
                this.passwordHistory = [];
                this.saveHistory();
                this.renderHistory();
                this.showNotification('Cleared', 'Password history cleared', 'info');
            }

            renderHistory() {
                const historyList = document.getElementById('historyList');
                
                if (this.passwordHistory.length === 0) {
                    historyList.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-history"></i>
                            <p>No password history available</p>
                        </div>
                    `;
                    return;
                }
                
                const html = this.passwordHistory.map(entry => `
                    <div class="history-item">
                        <div class="history-info">
                            <span class="history-length">${entry.length} chars</span>
                            <span class="history-strength ${entry.strength.toLowerCase().replace(' ', '-')}">${entry.strength}</span>
                            <span class="history-patterns">${entry.patterns} issues</span>
                        </div>
                        <div class="history-date">${new Date(entry.timestamp).toLocaleString()}</div>
                    </div>
                `).join('');
                
                historyList.innerHTML = html;
            }

            // Settings
            loadSettings() {
                const saved = localStorage.getItem('sg-settings');
                if (saved) {
                    this.settings = {...this.settings, ...JSON.parse(saved)};
                }
                this.applySettings();
            }

            saveSettings() {
                localStorage.setItem('sg-settings', JSON.stringify(this.settings));
            }

            applySettings() {
                Object.keys(this.settings).forEach(key => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = this.settings[key];
                        } else {
                            element.value = this.settings[key];
                            if (key === 'debounceDelay') {
                                document.getElementById('debounceValue').textContent = this.settings[key];
                            }
                        }
                    }
                });
            }

            // Modal management
            showGeneratorModal() {
                this.els.generatorModal.style.display = 'flex';
                this.generatePassword();
                document.getElementById('passLength').focus();
            }

            showHistoryModal() {
                this.els.historyModal.style.display = 'flex';
                this.renderHistory();
            }

            showSettingsModal() {
                this.els.settingsModal.style.display = 'flex';
            }

            closeAllModals() {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.style.display = 'none';
                });
            }

            // Statistics
            incrementCheckCount() {
                this.checkCount++;
                this.updateCheckCount();
                localStorage.setItem('sg-check-count', this.checkCount.toString());
                this.els.lastCheck.textContent = `Last check: ${new Date().toLocaleTimeString()}`;
            }

            updateCheckCount() {
                this.els.checkCount.textContent = `Passwords checked: ${this.checkCount}`;
            }

            // Notifications
            showNotification(title, message, type = 'info') {
                if (!this.settings.enableNotifications) return;
                
                const notification = document.createElement('div');
                notification.className = `notification ${type}`;
                notification.innerHTML = `
                    <div class="notification-content">
                        <strong>${title}</strong>
                        <p>${message}</p>
                    </div>
                    <button class="notification-close">&times;</button>
                `;
                
                this.els.notifications.appendChild(notification);
                
                // Auto remove after 5 seconds
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 5000);
                
                // Manual close
                notification.querySelector('.notification-close').addEventListener('click', () => {
                    notification.remove();
                });
            }

            resetAnalysis() {
                this.els.analysis.classList.remove('active');
                this.els.breach.classList.remove('active');
                this.els.patterns.classList.remove('active');
                this.els.composition.classList.remove('active');
                this.els.strengthProgress.style.width = '0%';
                this.els.strengthLabel.textContent = 'Enter a password to check';
                this.els.scoreValue.textContent = '';
                this.els.entropyInfo.innerHTML = '';
                this.currentAnalysis = null;
            }
        }

        // Initialize the application
        const secureGuard = new SecureGuard();
    </script>
</body>
</html>